<template name="tree" args="data tree isRoot current onClick">
  <ul class="{isRoot ? 'tree' : ''}">
     <li each="fso, fso.path in data">
       <if condition="fso.isFile">
         <a href="{'/file?path=' + fso.relativePath}">
           <span data-name="{fso.name}" data-path="{fso.relativePath}" class="name icon icon-file-text">
            {fso.name}
          </span>
         </a>
       </if>
       <if condition="fso.isDirectory">
         <a onclick="{onClick(fso)}">
           <small if="fso.expanded" class="expanded">▼</small>
           <small if="!fso.expanded" class="collapsed">▶</small>
           <span data-name="{fso.name}" data-path="{fso.relativePath}" class="name icon icon-file-directory">
            {fso.name}
          </span>
         </a>
       </if>
      <span if="fso.isFile && fso === current" class="triangle-left"></span>
      <if condition="fso.isDirectory && fso.expanded">
        <script>
          fso.children.sort(function(a, b) {
            if (a.isDirectory) {
              if (b.isDirectory) {
                return a.name.toLowerCase() < b.name.toLowerCase() ? -1 : 1
              } else {
                return -1
              }
            } else {
              if (b.isDirectory) {
                return 1
              } else {
                return a.name.toLowerCase() < b.name.toLowerCase() ? -1 : 1
              }
            }
          })
          tree(fso.children, tree, false, current, onClick)
        </script>
      </if>
     </li>
   </ul>
 </template>
