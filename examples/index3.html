<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Superviews</title>
  <style>
    .active {
      color: red;
    }
  </style>
  <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
  <script src="../node_modules/supermodels.js/dist/supermodels.js"></script>
  <script src="../dist/superviews.js"></script>
</head>

<body>
  <h1>A look at loops</h1>
  
  <div ui-with="app" ui-title="name">

    <p ui-text="name"></p>
    <p ui-text="items.length"></p>  
    <ul>
      <li ui-for="items">
        <span ui-text="name"></span>&nbsp;|&nbsp;<span ui-text="text"></span>
        <ul>
          <li ui-for="subItems">
            <span ui-text="foo"></span>
            <ul>
              <li ui-for="subItems">
                <span ui-text="bar"></span>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>

    <div ui-with="something">
      <p ui-text="whatever"></p>  
    </div>
    
    <div ui-with="items">
      <p ui-text="__parent.name"></p>  
    </div>

    <pre id="json">
    </pre>
  </div>

  <script>
    var app = supermodels({
      name: 'My App Name',
      currentItemId: Number,
      something: {
        whatever: String
      },
      items: [{
        name: '',
        text: '',
        quantity: Number,
        index: {
          __enumerable: false,
          __get: function() {
            var parent = this.__parent;
            var index = parent.indexOf(this);
            return index;
          }
        },
        get isCurrent() {
          return this.index === this.__parent.__parent.currentItemId;
        },
        get isFirst() {
          return this.index === 0;
        },
        get isLast() {
          return this.index === (this.__parent.length - 1);
        },
        subItems: [{
          foo: String,
          subItems: [{
           bar: String 
          }]
        }]
      }]
    });

    // add a few items
    var newItem1 = app.items.create();
    newItem1.name = 'item1';
    newItem1.text = 'item1 text';
    newItem1.quantity = 4;
    app.items.push(newItem1);
    
    // var newItem2 = app.items.create();
    // newItem2.name = 'item2';
    // newItem2.text = 'item2 text';
    // newItem2.quantity = 4;
    // app.items.push(newItem2);
    
    // add a few more blank items
    app.items.push(app.items.create());
    // app.items.push(app.items.create());
    // app.items.push(app.items.create());
    // app.items.push(app.items.create());
    
    // now for some subItems to test deep lists
    var subItem = newItem1.subItems.create();
    subItem.foo = 'foofoo';
    newItem1.subItems.push(subItem);
    
    var subSubItem = subItem.subItems.create();
    subSubItem.bar = 'barbar';
    subItem.subItems.push(subSubItem);
    
    var $body = $(document.body);
    var $json = $('#json');
    
    // helper function to render the json onchange
    function renderJson() {
      $json.html(JSON.stringify(app, null, 2));
    }
    renderJson();
    
    app.something.whatever = 'dsfsdfs';
    
    // now to make the call to superviews
    // to initialize the bindings etc.
    superviews();
    
    // Brute force update the whole ui whenever 'app' changes.
    // You would probably want to be more granular than this.
    app.on('change', function() {
      renderJson();
      superviews();
    });
    
  </script>
  
</body>

</html>